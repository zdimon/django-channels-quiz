(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{24:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var c=n(0),s=n(1),a=n.n(s),r=n(4),i=n.n(r),o=(n(24),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,46)).then((function(t){var n=t.getCLS,c=t.getFID,s=t.getFCP,a=t.getLCP,r=t.getTTFB;n(e),c(e),s(e),a(e),r(e)}))}),u=n(2),l=n(6),j=n.n(l),m=n(9),b=n(7),d=n(5),g=n(10),h=n.n(g),f="http://quiz.webmonstr.com/v1/quiz/",O=function(){function e(){Object(b.a)(this,e)}return Object(d.a)(e,[{key:"get",value:function(){var e=Object(m.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.get("".concat(f).concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=Object(m.a)(j.a.mark((function e(t,n){var c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.post("".concat(f).concat(t),n);case 2:return c=e.sent,e.abrupt("return",c.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),p=n(45),x=function(){function e(){Object(b.a)(this,e),this.timer=null,this.websocket=null,this.newMessage$=void 0,this.newQuestion$=void 0,this.updateAccount$=void 0,this.newMessage$=new p.a,this.newQuestion$=new p.a,this.updateAccount$=new p.a,this.wsConnect()}return Object(d.a)(e,null,[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),Object(d.a)(e,[{key:"wsConnect",value:function(){var e=this;clearInterval(this.timer),this.websocket=new WebSocket("ws://quiz.webmonstr.com:7777/quiz/"),this.websocket.onerror=function(t){e.timer=setTimeout((function(){return e.wsConnect()}),2e3)},this.websocket.onmessage=function(t){var n=JSON.parse(t.data);console.log(n),"message"===n.type&&e.newMessage$.next(n.message),"new_question"===n.type&&e.newQuestion$.next(n),"update_account"===n.type&&e.updateAccount$.next(n)},this.websocket.onclose=function(t){console.log("Close connection"),e.timer=setTimeout((function(){return e.wsConnect()}),2e3)}}}]),e}();x.instance=void 0;var v=x.getInstance();function w(e){Object(s.useEffect)((function(){v.newMessage$.subscribe((function(e){(e.is_right||"new_question"===e.type)&&(new O).get("get_current_question").then((function(e){r(e)}))})),v.newQuestion$.subscribe((function(e){(new O).get("get_current_question").then((function(e){r(e)}))}))}),[]);var t=Object(s.useState)({question:"",answers:""}),n=Object(u.a)(t,2),a=n[0],r=n[1];return Object(s.useEffect)((function(){(new O).get("get_current_question").then((function(e){r(e)}))}),[]),Object(c.jsxs)("div",{className:"question",children:["\u0412\u043e\u043f\u0440\u043e\u0441: ",a.question]})}function N(e){var t=Object(s.useState)(0),n=Object(u.a)(t,2),a=n[0],r=n[1];return Object(c.jsx)(c.Fragment,{children:Object(c.jsx)("img",{width:"50",alt:"",className:" ".concat(e.item.id===a?"sticker-active":""," "),onClick:function(){return t=e.item.id,e.onSelectSticker(t),void r(t);var t},src:e.item.get_url})})}function y(){var e=Object(s.useState)([]),t=Object(u.a)(e,2),n=t[0],a=t[1],r=Object(s.useState)(0),i=Object(u.a)(r,2),o=i[0],l=i[1],j=Object(s.useState)(""),m=Object(u.a)(j,2),b=m[0],d=m[1];Object(s.useEffect)((function(){(new O).get("sticker/list").then((function(e){a(e)}))}),[]);var g=function(e){l(e)};return Object(c.jsxs)("div",{className:"login-form",children:[Object(c.jsx)("p",{children:"\u041a\u0430\u043a \u0432\u0430\u0441 \u0437\u043e\u0432\u0443\u0442?"}),Object(c.jsx)("p",{children:Object(c.jsx)("input",{onChange:function(e){d(e.target.value)},type:"text",className:"round"})}),Object(c.jsx)("p",{children:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443"}),Object(c.jsx)("div",{className:"stickers",children:n.map((function(e,t){return Object(c.jsx)(N,{onSelectSticker:g,item:e},t)}))}),Object(c.jsx)("button",{onClick:function(){var e={sticker_id:o,name:b};(new O).post("player/join",e).then((function(e){localStorage.setItem("username",b),localStorage.setItem("image",e.sticker.get_url),localStorage.setItem("account",e.account),window.location.reload()}))},id:"chat-start",className:"btn bg-white mt-3",children:"\u041d\u0430\u0447\u0430\u0442\u044c!"})]})}function S(){var e=new O,t=Object(s.useState)(""),n=Object(u.a)(t,2),a=n[0],r=n[1],i=function(){if(a.length>0){var t={message:a,playername:localStorage.getItem("username")};e.post("save_message",t).then((function(e){r("")}))}};return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("input",{type:"text",className:"form-control mr-3",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043e\u0442\u0432\u0435\u0442 \u043d\u0430 \u0432\u043e\u043f\u0440\u043e\u0441",value:a,onChange:function(e){r(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&i()}}),Object(c.jsxs)("button",{onClick:i,type:"submit",className:"btn btn-primary d-flex align-items-center p-2",children:[Object(c.jsx)("i",{className:"fa fa-paper-plane-o","aria-hidden":"true"}),Object(c.jsx)("span",{className:"d-none d-lg-block ml-1",children:"Send"})]})]})}function k(e){return Object(c.jsxs)("div",{className:"chat ".concat(e.message.is_right?"chat-left":""),children:[Object(c.jsxs)("div",{className:"chat-user",children:[Object(c.jsx)("a",{className:"avatar m-0",children:Object(c.jsx)("img",{src:e.message.playerimage,alt:"avatar",className:"avatar-35 "})}),Object(c.jsx)("span",{className:"chat-time mt-1",children:e.message.playername})]}),Object(c.jsx)("div",{className:"chat-detail",children:Object(c.jsx)("div",{className:"chat-message",children:Object(c.jsxs)("p",{children:[e.message.text," ",e.message.is_right]})})})]})}var I=x.getInstance();function _(e){Object(s.useEffect)((function(){I.newMessage$.subscribe((function(e){(new O).get("message/list").then((function(e){r(e)}))}))}),[]);var t=Object(s.useState)([]),n=Object(u.a)(t,2),a=n[0],r=n[1];return Object(s.useEffect)((function(){(new O).get("message/list").then((function(e){r(e),console.log(e)}))}),[]),Object(c.jsx)("div",{className:"messages",children:a.map((function(e,t){return Object(c.jsx)(k,{message:e},t)}))})}var E=x.getInstance();function q(e){var t=Object(s.useState)(""),n=Object(u.a)(t,2),a=n[0],r=n[1],i=Object(s.useState)(0),o=Object(u.a)(i,2),l=o[0],j=o[1];return Object(s.useEffect)((function(){E.updateAccount$.subscribe((function(e){console.log("update"),e.message.name===localStorage.getItem("username")&&(console.log("asdqwadadsa"),j(e.message.account),localStorage.setItem("account",e.message.account))}))}),[]),Object(s.useEffect)((function(){r(localStorage.getItem("image")),j(localStorage.getItem("account"))}),[]),Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)("div",{className:"avatar chat-user-profile m-0 mr-3",children:[Object(c.jsx)("img",{src:"images/logo.png",className:"mylogo img-fluid",alt:""}),Object(c.jsx)("img",{src:a,alt:"avatar",className:"avatar-50 "})]}),Object(c.jsx)("h5",{className:"mb-0",children:localStorage.getItem("username")}),"\xa0",Object(c.jsxs)("h5",{className:"player-account",children:[" \u041f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0445 \u043e\u0442\u0432\u0435\u0442\u043e\u0432: ",l]})]})}function C(e){return Object(c.jsx)("div",{className:"media-height p-3",children:Object(c.jsxs)("div",{className:"media align-items-center mb-4",children:[Object(c.jsx)("div",{className:"iq-profile-avatar status-online",children:Object(c.jsx)("img",{className:"rounded-circle avatar-50",src:e.user.sticker.get_url,alt:""})}),Object(c.jsxs)("div",{className:"media-body ml-3",children:[Object(c.jsx)("h6",{className:"mb-0",children:Object(c.jsxs)("a",{href:"#",children:["\u041e\u0447\u043a\u043e\u0432: ",e.user.account]})}),Object(c.jsx)("p",{className:"mb-0",children:e.user.name})]})]})})}var $=x.getInstance();function M(e){var t=Object(s.useState)([]),n=Object(u.a)(t,2),a=n[0],r=n[1];return Object(s.useEffect)((function(){$.newMessage$.subscribe((function(e){e.is_right&&(new O).get("player/list").then((function(e){r(e)}))}))}),[]),Object(s.useEffect)((function(){(new O).get("player/list").then((function(e){r(e)}))}),[]),Object(c.jsxs)(c.Fragment,{children:[a.map((function(e,t){return Object(c.jsx)(C,{user:e},t)})),Object(c.jsxs)("div",{className:"right-sidebar-toggle bg-primary mt-3",children:[Object(c.jsx)("i",{className:"ri-arrow-left-line side-left-icon"}),Object(c.jsx)("i",{className:"ri-arrow-right-line side-right-icon",children:Object(c.jsx)("span",{className:"ml-3 d-inline-block",children:"Close Menu"})})]})]})}localStorage.getItem("username")?(console.log("init"),i.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(w,{})}),document.getElementById("currentQuestionBlock")),i.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(S,{})}),document.getElementById("messageFormBlock")),i.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(_,{})}),document.getElementById("messageBox")),i.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(q,{})}),document.getElementById("currentPlayerBlock")),i.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(M,{})}),document.getElementById("playerListBlock"))):i.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(y,{})}),document.getElementById("#loginForm")),o()}},[[43,1,2]]]);
//# sourceMappingURL=main.764cc5ac.chunk.js.map